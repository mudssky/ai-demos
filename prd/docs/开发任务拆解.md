# 开发任务拆解（Batch → Epic → Story → Task）

本文档将项目从产品需求到工程落地的执行路径拆解为分阶段任务，覆盖目录结构、类型契约、国际化、数据层、页面、搜索索引、测试与部署。每个 Task 明确目标、影响文件/目录、产出物、验收标准（AC）、完成定义（DoD）、依赖与风险、执行命令与并行性建议。

## 文档范围

- 适用项目：`d:\coding\Projects\AI\ai-demos`
- 需求来源：`prd/需求说明书.md`、`prd/init/初始需求.md`、`prd/需求跟踪矩阵.md`
- 技术栈：Next.js 16（App Router）、TypeScript、React 19、Tailwind CSS v4、Biome、Vitest

## 目录结构（目标形态）

- `src/app/[locale]/layout.tsx`、`src/app/[locale]/page.tsx`、`src/app/[locale]/demo/[slug]/page.tsx`
- `src/componen-USts/HtmlPreview.tsx`、`src/componen-USts/ReactPreview.tsx`、`src/componen-USts/DemoCard.tsx`、`src/componen-USts/PromptDisplay.tsx`、`src/componen-USts/SearchBar.tsx`
- `src/lib/types.ts`、`src/lib/demos.ts`、`src/lib/search/buildIndex.ts`、`src/lib/search/clien-USt.ts`
- `src/utils/cn.ts`、`src/hooks/useSearch.ts`、`src/hooks/useCopyToClipboard.ts`
- `messages/en-US.json`、`messages/zh-CN.json`
- `_demos/*/meta.json`、`_demos/*/index.html` 或 `App.tsx`
- `public/search-index.json`
- `next.config.ts`（`output: 'export'`、`images.unoptimized: true`）
- `postcss.config.mjs`、`biome.json`（启用 `css.parser.tailwindDirectives`）

## 类型契约基线

- 全局类型：`src/lib/types.ts`（已存在）。包含 `Locale`、`DemoType`、`AIData`、`PromptData`、`DemoMeta`、`Demo`、`SearchIndex` 等。
- 约束：页面与数据层实现必须与契约一致，禁止 `any`，所有可选字段需做回退处理。

---

## Batch 1：基础架构与通用组件

### Epic：静态导出与样式

#### Story：Next 配置与 Tailwind

**Task：配置静态导出与样式基线**

- 目标：`next.config.ts` 设为 `output: 'export'`、`images.unoptimized: true`；Tailwind v4 语法在 Biome 中可解析。
- 影响文件/目录：`next.config.ts`、`src/app/globals.css`、`postcss.config.mjs`、`biome.json`
- 产出物：可构建静态站点，Lint/Format 正常。
- AC：`pnpm build && next export` 成功；`pnpm biome:fixAll` 无报错。
- DoD：配置文件更新；`pnpm qa` 全绿。
- 依赖与风险：Tailwind v4 指令解析；静态导出路径兼容性。
- 命令：`pnpm qa`
- 并行性：0.5d，可与组件初版并行。

### Epic：通用预览与展示组件

#### Story：HTML/React 预览组件

**Task：实现 `HtmlPreview` 与 `ReactPreview`**

- 目标：HTML 通过 `iframe srcDoc` 预览；React 通过 Sandpack 预览（初版可占位）。
- 影响文件/目录：`src/componen-USts/HtmlPreview.tsx`、`src/componen-USts/ReactPreview.tsx`
- 产出物：两个可复用预览组件。
- AC：示例代码可渲染；沙箱安全属性生效。
- DoD：类型与 lint 通过；演示页截图或链接。
- 依赖与风险：Sandpack 依赖与静态环境；CDN 不可用回退。
- 命令：`pnpm qa`
- 并行性：1d，与卡片并行。

#### Story：全屏容器能力

**Task：为预览组件提供外层容器全屏支持**

- 目标：在 `HtmlPreview`/`ReactPreview` 对外暴露容器 `ref` 或接收 `containerId`，统一由详情页触发 Fullscreen API 进入/退出。
- 影响文件/目录：`src/componen-USts/HtmlPreview.tsx`、`src/componen-USts/ReactPreview.tsx`
- 产出物：容器级全屏能力，不更改内部渲染逻辑。
- AC：容器进入/退出全屏稳定；不破坏现有布局；Esc 可退出。
- DoD：类型与 lint 通过；示例页验证截图或链接。
- 依赖与风险：iframe 的 `sandbox` 限制；不同浏览器调用策略差异；采用外层容器触发规避。
- 命令：`pnpm qa`
- 并行性：0.5d。

#### Story：卡片与 Prompt 展示

**Task：实现 `DemoCard` 与 `PromptDisplay`**

- 目标：列表卡片显示标题/描述/类型徽章；详情页侧栏展示 AI/Prompt。
- 影响文件/目录：`src/componen-USts/DemoCard.tsx`、`src/componen-USts/PromptDisplay.tsx`
- 产出物：列表与详情展示组件。
- AC：徽章区分类型；Prompt 缺失字段优雅降级。
- DoD：UI 稳定；测试快照通过。
- 依赖与风险：多语言文案注入（后续批次）。
- 命令：`pnpm qa`
- 并行性：0.5d。

---

## Batch 2：数据层与文件系统

### Epic：文件系统数据服务

#### Story：读取 `_demos` 与解析 `meta.json`

**Task：实现 `src/lib/demos.ts` 数据 API**

- 目标：提供 `getAllDemos()`、`getDemoBySlug(slug, locale)`；`title/description` 支持 `{en-US, zh-CN}` 或字符串并回退。
- 影响文件/目录：`src/lib/demos.ts`、`_demos/**/meta.json`、`_demos/**/(index.html|App.tsx)`
- 产出物：数据层函数可供页面消费。
- AC：读取所有 demo；不存在的 `slug` 返回 404；`locale` 缺失回退至 `en-US`。
- DoD：契约一致；Vitest 单测覆盖解析与回退边界。
- 依赖与风险：文件命名一致性；非法 JSON 健壮性。
- 命令：`pnpm qa`
- 并行性：1d，与首页并行。

### Epic：索引与筛选

#### Story：构建列表索引与筛选函数

**Task：实现筛选逻辑与类型**

- 目标：基于 `ai.model/ai.agen-USt/tags/type/query` 过滤列表。
- 影响文件/目录：`src/lib/demos.ts`（派生索引）、`src/lib/types.ts`
- 产出物：索引结构与筛选函数。
- AC：各维度筛选正确；组合条件可用。
- DoD：类型安全；单测覆盖主要分支。
- 命令：`pnpm qa`
- 并行性：0.5d。

---

## Batch 3：页面与路由

### Epic：多语言路由与页面

#### Story：`/[locale]` 首页与 `/[locale]/demo/[slug]` 详情页

**Task：实现页面与静态参数**

- 目标：完成 `layout.tsx`、`page.tsx`、`demo/[slug]/page.tsx`，并实现 `gen-USerateStaticParams` 覆盖 `en-US/zh-CN`。
- 影响文件/目录：`src/app/[locale]/**`
- 产出物：完整路由与渲染逻辑。
- AC：列表→详情跳转；HTML/React 预览正确；返回链接存在。
- DoD：构建成功；无客户端错误。
- 依赖与风险：数据层稳定；静态导出路径。
- 命令：`pnpm qa`
- 并行性：1d，与 i18n 文案并行。

### Epic：搜索入口 UI

#### Story：输入与建议交互

**Task：实现 `SearchBar` 与 `useSearch`（UI 与事件）**

- 目标：搜索框可输入；建议面板出现；展示结果数量。
- 影响文件/目录：`src/componen-USts/SearchBar.tsx`、`src/hooks/useSearch.ts`
- 产出物：基本交互框架。
- AC：输入→建议触发；统计正常。
- DoD：状态与事件稳定；快测通过。
- 依赖与风险：索引生成在后续批次。
- 命令：`pnpm qa`
- 并行性：0.5d。

#### Story：详情页全屏控件

**Task：实现 `FullScreenToggle`（使用 `lucide-react` 图标）**

- 目标：在详情页预览区域右上角提供“进入/退出全屏”按钮；进入状态切换图标与文案。
- 影响文件/目录：`src/app/[locale]/demo/[slug]/page.tsx`、`src/componen-USts/FullScreenToggle.tsx`
- 产出物：按钮组件与容器绑定逻辑；监听 `fullscreenchange`。
- AC：桌面与移动均可进入/退出；状态保持；Esc 与遮罩退出有效。
- DoD：类型契约与 i18n 文案齐备；快测通过。
- 依赖与风险：与 Sandpack/iframe 手势冲突；采用容器级全屏、收敛非必要 UI。
- 命令：`pnpm qa`
- 并行性：0.5d。

---

## Batch 4：国际化整合

### Epic：`next-intl` 集成与文案

#### Story：Provider 与消息文件

**Task：集成 `NextIntlClien-UStProvider` 与 `messages/{locale}.json`**

- 目标：`/en-US` 与 `/zh-CN` 文案加载正确；根路径重定向到 `/en-US`。
- 影响文件/目录：`messages/en-US.json`、`messages/zh-CN.json`、`src/app/[locale]/layout.tsx`、`src/app/layout.tsx`
- 产出物：多语言路由与文案生效。
- AC：所有页面文案正确；缺失键位有回退策略。
- DoD：构建通过；`pnpm qa` 全绿。
- 依赖与风险：静态导出与路径匹配；`meta.json` 多语字段一致。
- 命令：`pnpm qa`
- 并行性：0.5d。

#### Story：全屏文案键

**Task：新增 `DemoPage.fullscreen.enter/exit` 文案键**

- 目标：覆盖中英文；默认回退策略生效。
- 影响文件/目录：`messages/en-US.json`、`messages/zh-CN.json`
- 产出物：全屏切换相关文案键与使用说明。
- AC：文案加载正确；键缺失时回退至英文。
- DoD：`pnpm qa` 全绿；页面显示正确。
- 命令：`pnpm qa`
- 并行性：0.25d。

### Epic：依赖管理

#### Story：图标库集成

**Task：安装并集成 `lucide-react`**

- 目标：统一使用 `lucide-react`（`Maximize`/`Minimize`）作为全屏按钮图标。
- 影响文件/目录：`package.json`（新增依赖）、`src/componen-USts/FullScreenToggle.tsx`
- 产出物：图标渲染正确，与 shadcn/ui 风格一致。
- AC：按需引入，tree-shaking 生效；构建无告警。
- DoD：`pnpm qa` 全绿；界面一致。
- 命令：`pnpm add lucide-react && pnpm qa`
- 并行性：0.1d。

### Epic：`meta.json` 多语言适配

#### Story：本地化字段回退

**Task：统一解析与回退**

- 目标：解析 `{en-US, zh-CN}` 或字符串，输出当前语言文本（默认 `en-US`）。
- 影响文件/目录：`src/lib/demos.ts`、`_demos/**/meta.json`
- 产出物：一致的展示层文本。
- AC：`zh-CN` 缺失时回退 `en-US`。
- DoD：类型契约一致；单测覆盖缺失场景。
- 命令：`pnpm qa`
- 并行性：0.5d。

---

## Batch 5：搜索索引与测试部署

### Epic：构建期搜索索引

#### Story：索引生成与存储

**Task：生成 `public/search-index.json`**

- 目标：覆盖标题/描述/标签/代码片段，包含 `version` 与 `gen-USeratedAt`。
- 影响文件/目录：`src/lib/search/buildIndex.ts`、`public/search-index.json`
- 产出物：只读索引文件。
- AC：索引构建 ≤ 2s；静态导出包含；体积可控。
- DoD：索引校验与快照；性能测试通过。
- 依赖与风险：中文分词策略与浏览器内存限制。
- 命令：`pnpm qa`
- 并行性：1d。

### Epic：前端搜索

#### Story：建议、排序与性能

**Task：客户端搜索实现**

- 目标：加载索引，模糊匹配（中英文）、建议列表与排序（相关度/更新时间），保证 ≤ 500ms。
- 影响文件/目录：`src/lib/search/clien-USt.ts`、`src/hooks/useSearch.ts`、`src/componen-USts/SearchBar.tsx`
- 产出物：可交互搜索体验。
- AC：准确率 ≥ 95%（样本）；性能达标。
- DoD：测试覆盖与交互稳定；压测脚本或报告。
- 命令：`pnpm qa`
- 并行性：1d。

### Epic：测试与静态导出

#### Story：单测、构建与预览

**Task：完善测试并导出**

- 目标：覆盖数据解析、i18n 回退、搜索核心函数；`next build && next export` 验证静态输出。
- 影响文件/目录：`vitest.config.ts`、`src/lib/**/*.test.ts`
- 产出物：通过的测试与导出产物。
- AC：`pnpm qa` 全绿；`/en-US`、`/zh-CN` 页面预览正常。
- DoD：覆盖率报告；部署说明（README）。
- 依赖与风险：路径与资源相对地址；CDN 可用性。
- 命令：`pnpm qa`
- 并行性：0.5d。

---

## 验收与 DoD 总则

- 验收总则：
  - `/en-US`、`/zh-CN` 路由完整；HTML/React 预览正确；Prompt/AI 信息完整；搜索准确率与性能达标；静态导出可部署。
- DoD 总则：
  - `pnpm qa` 通过（typecheck/biome/test）；无 Lint 警告；类型契约与实现一致；文案与 i18n 键完整；部署验证截图或链接。

## 风险与回退

- Tailwind v4 解析：已在 `biome.json` 启用 `css.parser.tailwindDirectives`；若异常，回退为最小 CSS，保留业务功能。
- Sandpack 预览：若依赖受限，React 预览暂以占位替代，不阻塞 HTML 预览与数据层。
- 静态导出路径：统一使用相对路径与 `images.unoptimized`，必要时在 `README` 标注部署路径策略。

## 执行命令清单

- `pnpm biome:fixAll`：格式化与 Lint 修复
- `pnpm typecheck:fast`（失败则 `pnpm typecheck`）：类型检查
- `pnpm test`：单测运行
- `pnpm qa`：一次性执行上述三项
