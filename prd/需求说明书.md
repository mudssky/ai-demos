# AI Code Gallery 项目需求说明书

文档版本：v0.1.0  
文档状态：草案  
最近更新：2025-11-28  
适用范围：Next.js App Router 静态导出站点（Windows 开发环境）

## 修订历史

| 版本 | 日期 | 作者 | 说明 |
| --- | --- | --- | --- |
| v0.1.0 | 2025-11-28 | 系统 | 基于《初始需求》《i18n》文档合并与结构化；补充优先级与难度；标注 i18n 要求 |

## 目录

- 概述
- 目标与范围
- 架构总览
- 目录结构
- 功能模块需求
- 数据与类型定义
- 安全与合规
- 非功能性要求
- 依赖与第三方
- 测试与验收
- 风险与假设
- 术语定义
- 附录：原型/截图链接

## 概述

本项目旨在构建一个展示 AI 生成代码（HTML/React）的静态网站，兼顾性能与 SEO，支持多语言（i18n），并以文件系统作为内容数据源。

## 目标与范围

- 目标：以静态导出方式提供 AI 代码示例的浏览、预览与元数据展示，支持中英双语。
- 范围：数据读取、首页列表、详情预览、提示词与模型信息展示、代码复制、国际化、静态部署与基本筛选能力。

## 架构总览

- 技术栈：Next.js App Router（SSG/Static Export）、TypeScript、Tailwind（CDN 注入）、Sandpack（React 预览）、`iframe`（HTML 预览）。
- 数据源：文件系统 `_demos`（File System as Database）。
- 渲染策略：
  - HTML：`<iframe srcDoc>` 沙箱渲染与样式隔离。
  - React：`@codesandbox/sandpack-react` 在浏览器端实时编译与运行。

参考来源：`prd/初始需求.md:7-16, 241-274`

## 目录结构

```text
my-ai-gallery/
├── messages/
│   ├── en.json
│   └── zh.json
├── app/
│   └── [locale]/
│       ├── layout.tsx
│       ├── page.tsx
│       └── demo/
│           └── [slug]/
│               └── page.tsx
├── components/
│   ├── DemoCard.tsx
│   ├── HtmlPreview.tsx
│   └── ReactPreview.tsx
├── lib/
│   ├── demos.ts
│   └── types.ts
├── _demos/
│   ├── 01-glassmorphism-card/
│   │   ├── index.html
│   │   └── meta.json
│   └── 02-react-todo-list/
│       ├── App.tsx
│       └── meta.json
└── public/
```

参考来源：`prd/初始需求.md:17-41`, `prd/i18n.md:15-33`

## 功能模块需求

### 模块 A：数据源与读取（File System as DB）

- 描述：在构建期读取 `_demos` 目录，解析 `meta.json` 与代码文件，生成静态页面数据。
- 需求：
  - `lib/demos.ts` 提供 `getAllDemos`、`getDemoBySlug(locale)` 等函数。
  - `meta.json` 包含基础信息与 AI 上下文；支持 i18n 的标题与描述字段。[i18n]
  - `lib/types.ts` 定义 `DemoType`、`AIData`、`PromptData`、`DemoMeta`、`Demo` 类型。
- 验收：构建时能正确读取所有 Demo；对不存在的 `slug` 返回 404；多语言字段按 `locale` 回退到 `en`。
- 优先级：P0；难度：中。
参考来源：`prd/初始需求.md:45-88, 277-383`, `prd/i18n.md:180-223`

### 模块 B：首页列表（目录浏览）

- 描述：以网格展示所有 Demo，显示标题、描述、类型徽章（HTML/REACT），并链接到详情。
- 需求：
  - 列表卡片包含标题、描述摘要、类型徽章（颜色区分）。
  - 预留筛选器：按模型（`ai.model`）、Agent（`ai.agent`）、标签（`tags`）。
  - 路由前缀基于当前 `locale`。[i18n]
- 验收：在 `/[locale]` 下展示完整列表；点击卡片进入 `/[locale]/demo/[slug]`。
- 优先级：P0；难度：低。
参考来源：`prd/初始需求.md:206-239, 385-399`, `prd/i18n.md:156-176`

### 模块 C：详情页（代码与预览）

- 描述：展示选中 Demo 的代码与预览区域，并显示元数据（AI/Prompt）。
- 需求：
  - HTML 类型：左右分栏（左代码、右预览 `iframe`）。
  - React 类型：使用 Sandpack，集成编辑器与预览；注入 Tailwind CDN。
  - 显示 `title`、`description`、`type`、`ai`、`prompt` 信息；提供返回列表链接。[i18n]
- 验收：不同类型正确渲染；元信息完整可见；返回链接正确。
- 优先级：P0；难度：中。
参考来源：`prd/初始需求.md:149-204, 113-147, 241-250, 399-433`

### 模块 D：HTML 预览

- 描述：`HtmlPreview` 以 `iframe srcDoc` 沙箱渲染，隔离样式。
- 需求：
  - `sandbox="allow-scripts"`，禁止跨域访问，避免外部资源注入风险。
  - 组件尺寸可配置，默认高度 600px。
- 验收：能稳定渲染 Demo HTML；脚本运行受限且不影响站点安全。
- 优先级：P1；难度：低。
参考来源：`prd/初始需求.md:90-111`

### 模块 E：React 预览（Sandpack）

- 描述：`ReactPreview` 使用 `@codesandbox/sandpack-react`，以 `react-ts` 模板运行代码。
- 需求：
  - 配置 `files: {"/App.tsx": code}`；`externalResources` 注入 Tailwind CDN。
  - 浏览器端编译运行；隐藏导航与标签；自定义编辑器高度。
- 验收：能运行常见 React 组件示例；Tailwind 类名生效。
- 优先级：P0；难度：中。
参考来源：`prd/初始需求.md:113-147`

### 模块 F：提示词展示（PromptDisplay）

- 描述：在详情页展示生成该 Demo 的 Prompt 与 AI 模型/Agent 信息。
- 需求：
  - 显示 `ai.agent`、`ai.model`，主 Prompt，迭代说明（可选）。
  - 视觉样式：徽章 + 等宽字体块。
  - 文案可国际化。[i18n]
- 验收：所需字段存在则展示；缺失字段则优雅降级。
- 优先级：P1；难度：低。
参考来源：`prd/初始需求.md:399-433`

### 模块 G：复制代码按钮

- 描述：在预览区域旁提供“复制代码”操作。
- 需求：
  - 支持 HTML 与 React 两种类型；复制后提示（Toast）。
  - 文案可国际化。[i18n]
- 验收：点击复制成功；Toast 正确显示；跨浏览器可用。
- 优先级：P2；难度：低。
参考来源：`prd/初始需求.md:251-253`, `prd/i18n.md:62-94`

### 模块 H：国际化（next-intl）

- 描述：基于路径的多语言路由 `/[locale]/...`，静态导出支持。
- 需求：
  - 使用 `next-intl` 插件；`messages/{locale}.json` 管理文案。
  - `app/[locale]/layout.tsx` 中 `generateStaticParams` 预构建 `en`/`zh`。
  - `meta.json` 标题/描述提供多语言；`getDemoBySlug(locale)` 选择对应语言并带回退。[i18n]
  - 根路径默认重定向到 `/en`（静态导出环境）。
- 验收：`/en` 与 `/zh` 完整可用；详情页与首页文案正确切换；Meta 多语言生效。
- 优先级：P0；难度：中。
参考来源：`prd/i18n.md:1-176, 180-244`

### 模块 I：部署与静态导出

- 描述：配置 `next.config` 为 `output: 'export'`，`images.unoptimized: true`，可选 `basePath`。
- 验收：能导出静态站点并部署到 GitHub Pages/S3 等；在子路径下正常工作。
- 优先级：P0；难度：低。
参考来源：`prd/初始需求.md:254-264`, `prd/i18n.md:43-60`

### 模块 J：自动化生成 Demo（脚本）

- 描述：提供 Node.js 脚本，调用模型生成代码并写入 `_demos`。
- 需求：
  - 命令：`npm run generate "a login page"`。
  - 输出目录结构符合规范；自动生成 `meta.json`（含 `ai`、`prompt`、`tags`）。
- 验收：执行后新增 Demo 可在站点中显示；构建无报错。
- 优先级：P2；难度：中。
参考来源：`prd/初始需求.md:266-268`

### 模块 K：Demo 搜索（搜索与建议）

- 描述：提供高效、精准的 Demo 搜索能力，支持通过关键词快速定位相关示例，兼容静态导出架构（构建期生成索引，前端执行搜索）。
- 需求：
  - 搜索范围：覆盖 Demo 标题、描述、标签与代码内容（HTML/React 文本）。
  - 交互：
    - 在页面顶部添加搜索框（全局可见）。
    - 支持实时搜索建议（输入过程中展示候选项与关键匹配片段）。
    - 显示搜索结果数量；提供排序选项（相关度、更新时间）。
  - 技术：
    - 采用模糊搜索算法（如编辑距离/词权重/Token 匹配）。
    - 支持中英文混合搜索（英文词形与中文分词/拼音匹配策略）。
    - 与静态导出兼容：构建期生成只读索引 JSON（包含必要字段与倒排结构）；客户端按需加载与搜索。
    - 性能：单次查询响应时间 ≤ 500ms（桌面与移动常规设备）。
  - 测试：
    - 编写搜索功能测试用例，覆盖范围字段与交互（建议/排序/数量）。
    - 验证搜索结果准确率 ≥ 95%（以标注样本集为准，包含中英文混合样本）。
    - 进行性能压力测试（并发输入与批量查询场景下仍满足 ≤ 500ms）。
- 验收：在首页与详情入口均可触发搜索；范围覆盖与交互项完整；准确率与性能指标达标；静态导出无服务端依赖。
- 优先级：P0；难度：中；预计实现周期：2 周（含测试与压测）。
- 建议选型：前端搜索库可选 FlexSearch 或 Lunr（结合中文分词器）；索引生成在构建期由 `lib/demos.ts` 扩展脚本输出 `search-index.json`。

### 模块 L：全屏切换（FullScreen Toggle）

- 描述：为详情页的预览区域提供“进入/退出全屏”控件，统一支持 HTML（`HtmlPreview`）与 React（`ReactPreview`）两类 Demo，提升演示与阅读体验；按钮图标采用 `lucide-react`。
- 需求：
  - UI 控件：在详情页预览区域右上角提供全屏按钮；图标分别使用 `lucide-react` 的 `Maximize`（进入全屏）与 `Minimize`（退出全屏），尺寸 `16~20px`，颜色随主题（与 shadcn/ui 保持一致）。
  - HTML 预览：使用外层容器触发 Fullscreen API（`element.requestFullscreen()` / `document.exitFullscreen()`），避免在沙箱内调用；`iframe` 设置 `allowfullscreen` / `allow="fullscreen"` 以兼容不同浏览器策略。
  - React 预览：对 `ReactPreview` 外层容器进行全屏；进入全屏时可收敛非必要 UI（如编辑器工具条），退出时恢复原样。
  - 状态管理：监听并响应 `fullscreenchange` 事件；基于 `document.fullscreenElement` 切换文案与图标状态。
  - 键盘与手势：支持 `Esc` 退出；移动端提供遮罩点击退出；避免与 Sandpack/iframe 默认手势冲突。
  - 可访问性：按钮具备 `aria-pressed` 与可见焦点；提供 Tooltip 文案。
  - i18n：新增文案键 `DemoPage.fullscreen.enter`（“全屏”/“Fullscreen”）与 `DemoPage.fullscreen.exit`（“退出全屏”/“Exit fullscreen”），位于 `messages/{locale}.json`。
- 验收：在桌面与移动设备上均可稳定进入/退出全屏；预览内容与编辑状态保持不丢失；`Esc` 行为一致；覆盖 Chrome/Edge/Safari/Firefox 的最近两个主版本。
- 优先级：P0；难度：低-中。

## 数据与类型定义

- `meta.json` 结构建议：

```json
{
  "id": "001-glassmorphism-dashboard",
  "title": "玻璃拟态仪表盘",
  "description": "...",
  "type": "react",
  "ai": {"model": "claude-3-5-sonnet", "agent": "cursor", "provider": "anthropic"},
  "prompt": {"main": "...", "iteration": "..."},
  "tags": ["dashboard", "tailwind"],
  "createdAt": "2023-10-27T10:00:00Z",
  "version": "1.0"
}
```

- TypeScript 类型定义位于 `lib/types.ts`：`DemoType`、`AIData`、`PromptData`、`DemoMeta`、`Demo`。
参考来源：`prd/初始需求.md:275-383`

## 安全与合规

- 禁止提交任何密钥与凭证；脚本需使用环境变量管理机密。
- HTML 预览采用 `iframe` 沙箱，限制脚本能力，防止跨站影响。
- 外部资源（CDN）需可回退；保证隐私与合规。

## 非功能性要求

- 性能：静态导出 + 预渲染；页面首屏可用时间 ≤ 2s（常规网络）。
- SEO：静态 HTML 输出；合理的标题/描述与结构化数据（可选）。
- 可用性：UI 清晰；支持深色/浅色主题（可选）。
- 兼容性：现代浏览器最新两个大版本。

## 移动端适配与交互优化

- 移动端优先：采用 Mobile-first 设计与开发策略，逐步增强到更大断点。
- 断点与布局：
  - 断点覆盖：`320px`、`375px`、`414px`（iPhone 系列主流宽度）及 `≥768px` 的平板/桌面增强。
  - 单位：以 `rem/em` 为主，避免硬编码 `px`；基础 `html` 字体 `16px`（可按需缩放）。
  - 媒体查询：使用 CSS 媒体查询实现响应式布局，示例：

    ```css
    /* Mobile-first 基础样式 */
    :root { font-size: 16px; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 1rem; }
    @media (min-width: 20rem) { /* ≈320px */ }
    @media (min-width: 23.4375rem) { /* ≈375px */ .grid { grid-template-columns: 1fr 1fr; } }
    @media (min-width: 25.875rem) { /* ≈414px */ .grid { grid-template-columns: 1fr 1fr; } }
    @media (min-width: 48rem) { /* 768px */ .grid { grid-template-columns: 1fr 1fr 1fr; } }
    ```

- 视口设置：在 `app/[locale]/layout.tsx` 的 `<head>` 注入：

  ```html
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  ```

- 触控与可用性：
  - 可点击区域最小 `44×44px`；间距与可命中性优先。
  - 为触控设备优化 `:active`/`:focus` 态与可见焦点；避免仅依赖 `:hover`。
  - 表单优化：合理使用 `inputmode`/`type`（如 `type="email"`、`inputmode="numeric"`），禁用不必要的自动纠错与首字母大写。
  - 手势适配：支持基本滑动/滚动交互，不强制复杂手势；避免与内嵌 Sandpack/iframe 的默认手势冲突。
- i18n 与持久化：
  - 服务端文案推荐 `next-intl`；客户端语言切换与持久化可用 `i18next` + `localStorage('locale')`。
  - 资源文件结构：`/locales/en.json`、`/locales/zh.json`（或 `messages/{locale}.json`）；两者需一致映射。[i18n]
  - 切换逻辑：优先读取持久化选择；默认 `en`；切换后刷新到对应 `/[locale]` 路由。
- 验收：在主流 iOS/Android 设备与断点下布局稳定；点击区域与表单体验符合规范；语言切换可持久化并正确生效。

## 依赖与第三方

- `@codesandbox/sandpack-react`
- `next-intl`
- Tailwind CDN（`https://cdn.tailwindcss.com`）

## 测试与验收

- 单元测试：`lib/demos.ts` 的解析与回退逻辑。
- 构建测试：`next build && next export` 在本地通过，预览静态文件正常渲染。
- 手工验收：
  - `/en` 与 `/zh` 路由完整可用。
  - HTML/React 两类 Demo 正常预览。
  - Prompt 与 AI 信息展示正确。

## 风险与假设

- 静态导出下无法使用中间件做语言自动跳转；通过显式路径与默认重定向解决。
- 外部 CDN 不可用时影响样式；需本地样式回退或构建期注入（后续可优化）。
- Sandpack 运行复杂依赖的示例可能受限；约束示例范围与依赖。

## 术语定义

- Demo：一个可独立预览的代码示例单元。
- Agent：生成代码的工具或 IDE（如 Cursor、Bolt）。
- Model：生成代码的大模型（如 GPT-4、Claude 3.5）。

## 附录：原型/截图链接

- 首页网格与徽章示意：`docs/prototypes/home.png`（占位）
- 详情页分栏与 Prompt 区域：`docs/prototypes/detail.png`（占位）
